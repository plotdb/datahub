(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.sharehub=f()}})(function(){var define,module,exports;var _$datahub_1={exports:{}};(function(){var t,n,r,e,s,o,u,i;function p(t,n){var r={}.hasOwnProperty;for(var e in n)r.call(n,e)&&(t[e]=n[e]);return t}(t=n=function(t){var n=this;return null==t&&(t={}),this.opt=t,this.scope=t.scope||[],t.src&&t.src.pipe(this),this.subscriber=[],(t.subscriber||[]).map(function(t){return n.pipe.push(t)}),this}).prototype=p(Object.create(Object.prototype),{asSrc:function(t){var n=this;return null==t&&(t={}),this.src={get:t.get||function(){},opsOut:function(r){return t.opsOut(n.addon(r))||void n.addon(r)}}},asDes:function(t){return this.subscriber=[{opsIn:t.opsIn||function(){}}]},pipe:function(t){return t.src&&(console.warn("a hub is connected with multiple source. cut the previous source anyway."),t.src.cut(t)),this.subscriber.push(t),t.src=this,t},cut:function(t){var n;if(~(n=this.subscriber.indexOf(t)))return this.subscriber.splice(n,1),t.src=null},opsIn:function(t){var n,r=this;if(n=function(t,n){var r,e,s;for(r=0,e=n.length;r<e;++r)if(t[s=r]!==n[s])return;return t.slice(s+1)},this.scope&&(t=t.map(function(t){var e;return(e=p({},t)).p=n(t.p,r.scope),e})),(t=t.filter(function(t){return null!=t.p})).length)return this.subscriber.map(function(n){return n.opsIn(t)})},opsOut:function(t){var n=this;return this.scope&&t.map(function(t){return t.p=n.scope.concat(t.p)}),this.src.opsOut(t)},addon:function(t){var n,r;return n=[],r=this.get(),t.map(function(t){var e,s,o,u,i,c=[];for(e=r,s=[],o=0,u=t.p.length-1;o<u;++o)i=o,s.push(t.p[i]),null==e[t.p[i]]&&n.push(p({p:JSON.parse(JSON.stringify(s))},i===t.p.length-1&&t.si?{si:""}:{oi:{}})),c.push(e=e[t.p[i]]||{});return c}),t=n.concat(t)},get:function(){var t,n,r,e,s;for(t=this.src.get(),n=0,e=(r=this.scope).length;n<e;++n){if(s=r[n],!t)return null;t=t[s]}return t}}),(r=function(n){return null==n&&(n={}),t.call(this,n),this.asSrc({opsOut:n.opsOut||function(){},get:n.get||function(){}}),this}).prototype=p({},t.prototype),(e=function(n){return null==n&&(n={}),t.call(this,n),this.asDes({opsIn:n.opsIn}),this}).prototype=p({},t.prototype),(s=function(t){var n=this;return null==t&&(t={}),this.data={},r.call(this,p(p({},t),{opsOut:function(t){return n.data=json0.type.apply(n.data,t),n.opsIn(t)},get:function(){return JSON.parse(JSON.stringify(n.data))}})),this}).prototype=p({},r.prototype),(o=function(t){var n=this;return null==t&&(t={}),e.call(this,p(p({},t),{opsIn:function(r){return n.data?json0.type.apply(n.data,r):n.data=n.get()||{},t.render(r)}})),this}).prototype=p({},e.prototype),(u=function(n){var r=this;return null==n&&(n={}),this.src=n.src,this.src.pipe(this.hub=new t.des({opsIn:function(t){return r.update(t)}})),this.data=this.hub.get(),this}).prototype=p(Object.create(Object.prototype),{update:function(t){return json0.type.apply(this.data,t),this.render()},render:function(){return console.log("render is not implemented")}}),i=function(t){var n;return t.prototype=Object.create(Object.prototype),n=function(){var r,e,s,o,i;for(e=[],s=0,o=arguments.length;s<o;++s)e.push(arguments[s]);return r=e,i=Reflect.construct(u,r,n),t.apply(i,r),i},Object.setPrototypeOf(n.prototype,u.prototype),n},n.src=r,n.des=e,n.mem=s,n.usr=o,n.as=i,"undefined"!="object"&&null!==_$datahub_1?_$datahub_1.exports=n:"undefined"!=typeof window&&null!==window&&(window.datahub=n)}).call(this);_$datahub_1=_$datahub_1.exports;var _$sharehub_2={exports:{}};(function(){var r,t;try{r=_$datahub_1}catch(t){t,r=datahub}function n(r,t){var n={}.hasOwnProperty;for(var e in t)n.call(t,e)&&(r[e]=t[e]);return r}(t=function(t){var e=this;return null==t&&(t={}),this.evtHandler={},this.data={},this.id=t.id||"",this.create=t.create||null,r.src.call(this,n(n({},t),{opsOut:function(r){return e.data=json0.type.apply(e.data,r),e.doc.submitOp(JSON.parse(JSON.stringify(r)))},get:function(){return JSON.parse(JSON.stringify(e.data))}})),this}).prototype=n(n({},r.src.prototype),{on:function(r,t){var n;return((n=this.evtHandler)[r]||(n[r]=[])).push(t)},fire:function(r){var t,n,e,a,o,i,u,s=[];for(n=[],e=1,a=arguments.length;e<a;++e)n.push(arguments[e]);for(t=n,e=0,i=(o=this.evtHandler[r]||[]).length;e<i;++e)u=o[e],s.push(u.apply(this,t));return s},watch:function(r,t){return t||(this.data=json0.type.apply(this.data,t)),this.opsIn(JSON.parse(JSON.stringify(r)))},init:function(){var r=this;return Promise.resolve().then(function(){var t;return r.sdb=t=new sharedbWrapper({url:window.location.protocol.replace(":","")},window.location.domain),t.on("error",function(t){var n;return((n=r.evtHandler).error||(n.error=[])).length?r.fire("error",t.err):console.error(t.err)}),t.get({id:r.id,create:r.create?function(){return r.create()}:null,watch:function(){var t,n,e,a;for(n=[],e=0,a=arguments.length;e<a;++e)n.push(arguments[e]);return t=n,r.watch.apply(r,t)}})}).then(function(t){return r.doc=t,r.data=JSON.parse(JSON.stringify(r.doc.data)),{sdb:r.sdb}})}}),"undefined"!="object"&&null!==_$sharehub_2?_$sharehub_2.exports=t:"undefined"!=typeof window&&null!==window&&(window.sharehub=t)}).call(this);_$sharehub_2=_$sharehub_2.exports;return _$sharehub_2});
